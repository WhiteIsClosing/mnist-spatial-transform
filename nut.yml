syntax_version: "6"
project_name: gtsrb.torch
docker_image: matthieudelaro/cuda-torch-plus2
container_working_directory: /nut/gtsrb
enable_nvidia_devices: true
mount:
  main:
    - .
    - /nut/gtsrb
macros:
  setup:
    usage: download dataset and dependencies
    actions:
      - git clone https://github.com/qassemoquab/stnbhwd.git
      - cd stnbhwd && luarocks make stnbhwd-scm-1.rockspec
  test:
    usage: some tests
    actions:
    - luajit main.lua -o weights_some_tests --no_cuda --mnist
  test-gpu:
    usage: some tests
    enable_nvidia_devices: true
    actions:
    - luajit main.lua -o weights_some_tests --mnist

  train-gpu-distorted-mnist:
    usage: train-gpu-distorted-mnist
    enable_nvidia_devices: true
    actions:
    - luajit main.lua -o weights_train-gpu-distorted-mnist --mnist=distorted

  train-gpu-distorted-mnist-st:
    usage: train-gpu-distorted-mnist-st
    enable_nvidia_devices: true
    actions:
    - luajit main.lua --st -o weights_train-gpu-distorted-mnist-st --mnist=distorted
    # Initializing the trainer...
    # Starting epoch 1
    # <trainer> on training set:
    #  [======================================== 240000/240000 ==============================>]  Tot: 26m55s | Step: 6ms
    # <trainer> time to learn 1 sample = 6.7335770994425ms
    # <trainer> mean error (train set) = 0.017918109872627

    # <trainer> on testing Set:
    #  [======================================== 40000/40000 ================================>]  Tot: 1m17s | Step: 1ms
    # <trainer> time to test 1 sample = 1.9291370511055ms
    # <trainer> mean error (test set) = 0.0094988738860935
    # accuracy % :    85.07

    # Starting epoch 2
    # <trainer> on training set:
    #  [======================================== 240000/240000 ==============================>]  Tot: 26m48s | Step: 6ms
    # <trainer> time to learn 1 sample = 6.7047851542632ms
    # <trainer> mean error (train set) = 0.0094512670416385

    # <trainer> on testing Set:
    #  [======================================== 40000/40000 ================================>]  Tot: 1m17s | Step: 1ms
    # <trainer> time to test 1 sample = 1.9297495782375ms
    # <trainer> mean error (test set) = 0.0084487771641463
    # accuracy % :    86.63
  train:
    usage: train the network with default parameters
    enable_nvidia_devices: true
    actions:
      - time luajit main.lua -o weights_default_training # accuracy % :  97.094220110847, after 10 iterations, about 14 min
  train-2st-idsia:
    usage: train the network with two spatial transformers with idsia-like network
    enable_nvidia_devices: true
    actions:
      - time luajit main.lua -n -1 --st --net idsia_net.lua --cnn 150,200,300,350 --locnet 200,300,200 --locnet3 150,150,150 -e 26 -o train-2st-idsia
